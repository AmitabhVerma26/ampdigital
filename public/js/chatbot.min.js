$(function () {
	function e(e) {
		return /\S+@\S+\.\S+/.test(e)
	}
	$("#contactform").on("click", function(e){
        e.preventDefault();
        $(".chat-widget-container").click();
    })
	$(".alreadyaccount").off("click").on("click", function (e) {
		e.preventDefault(), $("#loginModal").modal("toggle"), $("#createAccount").modal("toggle")
    }), 
    
    $(".registernow").on("click", function (s) {
		s.preventDefault();
		var a = $(this).closest(".registerform"),
			n = a.find(".email").val(),
			o = a.find(".emailHelp"),
			t = a.find(".email"),
			l = a.find(".name").val(),
			i = a.find(".nameHelp"),
			d = a.find(".name"),
			r = a.find(".lastname").val(),
			c = a.find(".lastnameHelp"),
			m = a.find(".lastname"),
			h = a.find(".phone").val(),
			u = a.find(".phoneHelp"),
			v = a.find(".phone"),
			p = a.find(".password").val(),
			f = a.find(".passwordHelp"),
			g = a.find(".password"),
			C = a.find(".repassword").val(),
			w = a.find(".repasswordHelp"),
			b = a.find(".repassword");
		i.addClass("d-none"), d.removeClass("is-valid").removeClass("is-invalid"), c.addClass("d-none"), m.removeClass("is-valid").removeClass("is-invalid"), u.addClass("d-none"), v.removeClass("is-valid").removeClass("is-invalid"), o.addClass("d-none"), t.removeClass("is-valid").removeClass("is-invalid"), f.addClass("d-none"), g.removeClass("is-valid").removeClass("is-invalid"), w.addClass("d-none"), b.removeClass("is-valid").removeClass("is-invalid"), "" == l ? (d.addClass("is-invalid"), i.html("Please enter name").removeClass("d-none")) : "" == r ? (m.addClass("is-invalid"), c.html("Please enter last name").removeClass("d-none")) : "" == n ? (t.addClass("is-invalid"), o.html("Please enter email").removeClass("d-none")) : e(n) ? "" == h ? $.ajax({
			method: "GET",
			url: `/userexistsindatabase?email=${n}&password=aehgaeipg`
		}).done(function (e) {
			!1 !== e ? (t.addClass("is-invalid"), o.html('You already have account with this email. <a class="loginthroughthis" href="#">Log in</a> through this email.').removeClass("d-none")) : (v.addClass("is-invalid"), u.html("Please enter phone").removeClass("d-none")), $(".loginthroughthis").on("click", function (e) {
				e.preventDefault(), $(".alreadyaccount").click()
			})
		}) : "" == p ? (g.addClass("is-invalid"), f.html("Please enter password").removeClass("d-none")) : "" == C ? (b.addClass("is-invalid"), w.html("Please enter password again").removeClass("d-none")) : C !== p ? (b.addClass("is-invalid"), w.html("Passwords do not match").removeClass("d-none")) : $.ajax({
			method: "GET",
			url: `/userexistsindatabase?email=${n}&password=${p}`
		}).done(function (e) {
			!1 !== e ? (t.addClass("is-invalid"), o.html('You already have account with this email. <a class="loginthroughthis" href="#">Log in</a> through this email.').removeClass("d-none")) : a.submit(), $(".loginthroughthis").on("click", function (e) {
				e.preventDefault(), $(".alreadyaccount").click()
			})
		}) : (t.addClass("is-invalid"), o.html("Please enter valid email").removeClass("d-none"))
	}), $(".forgotpasswordbutton").on("click", function (e) {
		e.preventDefault(), $(".loginform").addClass("d-none"), $(".forgotpasswordform").removeClass("d-none"), $(".loginpaneltitle").html("Forgot Password")
	}), $(".loginformbutton").on("click", function (e) {
		e.preventDefault(), $(".loginform").removeClass("d-none"), $(".forgotpasswordform").addClass("d-none"), $(".loginpaneltitle").html("Login")
	}), $(".loginformbtn").on("click", function (s) {
		s.preventDefault();
		var a = $(this).prev(".loginform"),
			n = a.find(".email").val(),
			o = a.find(".emailHelp"),
			t = a.find(".password").val(),
			l = a.find(".passwordHelp"),
			i = a.find(".email"),
			d = a.find(".password");
		o.addClass("d-none"), i.removeClass("is-valid").removeClass("is-invalid"), l.addClass("d-none"), d.removeClass("is-valid").removeClass("is-invalid"), "" == n ? (i.addClass("is-invalid"), o.html("Please enter email").removeClass("d-none")) : e(n) ? "" == t ? (d.addClass("is-invalid"), l.html("Please enter password").removeClass("d-none")) : a.submit() : (i.addClass("is-invalid"), o.html("Please enter valid email").removeClass("d-none"))
    }), 
    
    $("#wisdom").on("keypress", function (e) {
		if (13 == e.keyCode) return pushChat()
	});
	var s = !0,
		a = ".chat-widget-container",
		n = $(".chat-box-container");
	$(".btn-chat-close").on("click", function () {
		$(n).toggleClass("show"), $(a).toggleClass("open"), $(".chat-box-form").addClass("d-none"), $(".chat-widget-wrapper").css("width", "111px")
	}), $(a).click(function (e) {
		e.preventDefault(), 1 == s && (setTimeout(function () {
			var e = document.getElementById("conversation"),
				s = document.createElement("P");
			s.className = "lexResponse", s.appendChild(document.createTextNode("Hi")), $(s).append('<img src="/kendra.svg" style="width: 2rem;">'), s.appendChild(document.createElement("br")), e.appendChild(s);
			var a = $(".chat-box-container.show");
			a.animate({
				scrollTop: a.height()
			}, 1e3)
		}, 800), setTimeout(function () {
			var e = document.getElementById("conversation"),
				s = document.createElement("P");
			s.className = "lexResponse", s.appendChild(document.createTextNode("I am Kendra. Do you want me to help you find something?")), s.appendChild(document.createElement("br")), $(s).append('<a style="color: white; background: #f42434!important;border-color: #f42434!important;" onclick="pushChat2()" class="btn btn-primary btn-yes">Yes</a>'), e.appendChild(s);
			var a = $(".chat-box-container.show");
			a.animate({
				scrollTop: a.height()
			}, 1e3)
		}, 1500), s = !1), $(n).toggleClass("show"), $(a).toggleClass("open"), $(n).hasClass("show") ? ($(".chat-box-form").removeClass("d-none"), $(".chat-widget-wrapper").css("width", "300px")) : ($(".chat-box-form").addClass("d-none"), $(".chat-widget-wrapper").css("width", "111px"))
	})
}), document.getElementById("wisdom").focus(), AWS.config.region = "eu-west-1", AWS.config.credentials = new AWS.CognitoIdentityCredentials({
	IdentityPoolId: "eu-west-1:dc8c07a4-afbb-46cf-98c3-a2daf5f0870a"
});
var lexruntime = new AWS.LexRuntime,
	lexUserId = "chatbot-demo" + Date.now(),
	sessionAttributes = {};

function pushChat2() {
	$(".btn-yes").remove();
	var e = {
		botAlias: "ampdigitalchatbot",
		botName: "AMPDigitalchatbot",
		inputText: "Yes",
		userId: lexUserId,
		sessionAttributes: sessionAttributes
	};
	return showRequest("Yes"), lexruntime.postText(e, function (e, s) {
		e && (console.log(e, e.stack), showError("Error:  " + e.message + " (see console for details)")), s && (sessionAttributes = s.sessionAttributes, showResponse(s))
	}), !1
}

function pushChat() {
	var e = document.getElementById("wisdom");
	if (e && e.value && e.value.trim().length > 0) {
		var s = e.value.trim();
		e.value = "", e.locked = !0;
		var a = {
			botAlias: "ampdigitalchatbot",
			botName: "AMPDigitalchatbot",
			inputText: s,
			userId: lexUserId,
			sessionAttributes: sessionAttributes
		};
		showRequest(s), lexruntime.postText(a, function (s, a) {
			s && (console.log(s, s.stack), showError("Error:  " + s.message + " (see console for details)")), a && (console.log("jere"), console.log(a), a.slots.Question && $.ajax({
				method: "POST",
				url: "/lexmail",
				data: a.slots
			}).done(function (e) {
				console.log(e)
			}), sessionAttributes = a.sessionAttributes, showResponse(a)), e.value = "", e.locked = !1
		})
	}
	return !1
}

function showRequest(e) {
	var s = document.getElementById("conversation"),
		a = document.createElement("P");
	a.className = "userRequest", a.appendChild(document.createTextNode(e)), s.appendChild(a);
	var n = $(".chat-box-content");
	n.animate({
		scrollTop: n.height()
	}, 1e3)
}

function showError(e) {
	var s = document.getElementById("conversation"),
		a = document.createElement("P");
	a.className = "lexError", a.appendChild(document.createTextNode(e)), s.appendChild(a);
	var n = $(".chat-box-container.show");
	n.animate({
		scrollTop: n.height()
	}, 1e3)
}

function showResponse(e) {
	var s = document.getElementById("conversation"),
		a = document.createElement("P");
	a.className = "lexResponse", e.message && (a.appendChild(document.createTextNode(e.message)), $(a).append('<img src="/kendra.svg" style="width: 2rem;">'), a.appendChild(document.createElement("br"))), e.dialogState, s.appendChild(a);
	var n = $(".chat-box-content");
	n.animate({
		scrollTop: n.height()
	}, 1e3)
}