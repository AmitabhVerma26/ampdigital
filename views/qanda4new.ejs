<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>AMP Digital Community | <%=post.content%></title>
  <meta name="description" content="Discuss your queries & Contribute to <%=module.module_name%> forum. <%=module.module_description%>">
  <meta name="keywords" content="discussion forum, question and answers, queries, community, digital marketing, <%=module.module_name%>">
  <meta name="author" content="AMP Digital">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta property="og:title" content="AMP Digital Community | <%=post.content%>" />
  <meta property="og:url" content="https://www.ampdigital.co/digital-marketing-community/<%=module.module_id%>" />
  <meta property="og:type" content="blog" />
  <meta property="og:description" content="Discuss your queries & Contribute to <%=module.module_name%> forum. <%=module.module_description%>" />
  <meta property="og:image" content="<%=module.module_image.split('?')[0]%>" />

  <!-- Bootstrap CSS-->
  <link rel="stylesheet" href="/vendor/bootstrap/css/bootstrap.min.css">
  <!-- Google fonts - Open Sans-->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700">
  <!-- Theme stylesheet-->
  <link rel="stylesheet" href="/css/style.default.min.css" id="theme-stylesheet">
  <!-- Favicon-->
  <link rel="shortcut icon" href="/logo-ampdigitalnet.png">
  <link rel="stylesheet" type="text/css" href="/commentjs/css/jquery-comments.css">
  <link rel="stylesheet" type="text/css"
    href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.3.1/css/fileinput.css">

  <style>
    .content{
      font-size: 18px;
      font-weight: bold!important;
    color: #424A4F;
    }
    @media only screen and (max-width: 768px) {
      .content{
      font-size: 16px;
      font-weight: bold!important;
    color: #424A4F;
    }
}
.child-comments .content{
  font-size: unset;
  font-weight: normal!important;
}
    .content{
    margin-top:1%;
    margin-bottom: 2%;
    }
    @media only screen and (max-width: 768px) {
      .content{
    margin-top:9%;
    margin-bottom: 2%;
    }
}
    .hero-banner {
      height: 200px;
      width: auto !important;
      background-size: cover !important;
      background-position: center center !important;
    }
    .jquery-comments .commenting-field.main, .jquery-comments .navigation {
      display: none!important;
}
  </style>
  <!-- Tweaks for older IEs-->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
  <!-- Google Tag Manager -->
  <script>(function (w, d, s, l, i) {
    w[l] = w[l] || []; w[l].push({
      'gtm.start':
        new Date().getTime(), event: 'gtm.js'
    }); var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
        'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-NTJGZ4L');</script>
  <!-- End Google Tag Manager -->
</head>

<head>
  <meta charset=utf-8>
  <meta name=description content="">
  <meta name=viewport content="width=device-width, initial-scale=1">
  <title>Jquery Comments Plugin</title>

  <!-- Styles -->

  <!-- Data -->

  <!-- Libraries -->



  <!-- Init jquery-comments -->


  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/jquery.textcomplete/1.8.0/jquery.textcomplete.js"></script>
  <script type="text/javascript" src="/commentjs/js/jquery-comments.js"></script>
              <link rel="stylesheet" href="https://www.ampdigital.co/css/font.min.css">

  <link rel="stylesheet" href="/vendor/bootstrap-select/css/bootstrap-select.min.css">
  <!-- Custom stylesheet - for your changes-->
  <link rel="stylesheet" href="/css/custom.min.css">
  <!-- <script src="/vendor/jquery/jquery.min.js"></script> -->
  <script src="/vendor/popper.js/umd/popper.min.js"> </script>
  <script src="/vendor/bootstrap/js/bootstrap.min.js"></script>
  <!-- <script src="/vendor/jquery.cookie/jquery.cookie.min.js"> </script> -->
  <script src="/vendor/bootstrap-select/js/bootstrap-select.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBu5nZKbeK-WHQ70oqOWo-_4VmwOwKP9YQ"></script>
  <script src="/js/front.js"></script>
  <script src="/js/custom/notification.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
<script src="https://rawgit.com/moment/moment/2.2.1/min/moment.min.js"></script>
<script src="https://sdk.amazonaws.com/js/aws-sdk-2.1.24.min.js"></script>
<script src='https://www.google.com/recaptcha/api.js' async defer></script>
<script type="text/javascript">
$(document).ready(function(){
    $('.alreadyaccount').on('click', function(e){
        e.preventDefault()
        $('#loginModal').modal('toggle');
        $('#createAccount').modal('toggle');
      });
  })
    AWS.config.update({
        accessKeyId : 'AKIAQFXTPLX2CNUSHP5C',
        secretAccessKey : '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'
    });
    AWS.config.region = 'us-west-2';
</script>
 <script type="text/javascript">
 $('.alreadyaccount').on('click', function(e){
        e.preventDefault()
        $('#loginModal').modal('toggle');
        $('#createAccount').modal('toggle');
      });
    var usersArray = [
      {
        id: 1,
        fullname: "Current User",
        email: "current.user@viima.com",
        profile_picture_url: "https://viima-app.s3.amazonaws.com/media/public/defaults/user-icon.png"
      },
      {
        id: 2,
        fullname: "Jack Hemsworth",
        email: "jack.hemsworth@viima.com",
        profile_picture_url: "https://viima-app.s3.amazonaws.com/media/public/defaults/user-icon.png"
      },
      {
        id: 3,
        fullname: "Hank Smith",
        email: "hank.smith@viima.com",
        profile_picture_url: "https://viima-app.s3.amazonaws.com/media/public/defaults/user-icon.png"
      },
      {
        id: 4,
        fullname: "Todd Brown",
        email: "todd.brown@viima.com",
        profile_picture_url: "https://viima-app.s3.amazonaws.com/media/public/defaults/user-icon.png"
      },
      {
        id: 5,
        fullname: "Administrator",
        email: "administrator@viima.com",
        profile_picture_url: "https://viima-app.s3.amazonaws.com/media/public/defaults/user-icon.png"
      },
      {
        id: 6,
        fullname: "Simon Powell",
        email: "simon.powell@viima.com",
        profile_picture_url: "https://viima-app.s3.amazonaws.com/media/public/defaults/user-icon.png"
      },
      {
        id: 7,
        fullname: "Bryan Connery",
        email: "bryan.connery@viima.com",
        profile_picture_url: "https://viima-app.s3.amazonaws.com/media/public/defaults/user-icon.png"
      }
    ]
    $(function () {
      $(".hBack").on("click", function(e){
    e.preventDefault();
    window.location.href = "/digital-marketing-community/"+$("body").data("module_url_id")
});
      $('.js-example-basic-single').select2();
      var postid = $("body").data("post_id");
      var moduleid = $("body").data("module_id");
      var modulename = $("body").data("module_name");
      var saveComment = function (data, savesuccess) {

        // Convert pings to human readable format
        // $(Object.keys(data.pings)).each(function(index, userId) {
        //     var fullname = data.pings[userId];
        //     var pingText = '@' + fullname;
        //     data.content = data.content.replace(new RegExp('@' + userId, 'g'), pingText);
        // });

        $.ajax({
          type: 'post',
          url: '/addnewcomment',
          data: data,
          success: function (comment) {
            savesuccess(comment);
            // success(data);
          }
        });

      }
      $('#comments-container').comments({
        profilePictureURL: 'https://viima-app.s3.amazonaws.com/media/public/defaults/user-icon.png',
        currentUserId: 1,
        roundProfilePictures: true,
        timeFormatter: function(time) {
          return moment(time).fromNow();
        },
        textareaRows: 1,
        textareaRowsOnFocus: 4,
        enableAttachments: true,
        enableHashtags: true,
        enablePinging: true,
        scrollContainer: $(window),
        searchUsers: function (term, success, error) {
          setTimeout(function () {
            success(usersArray.filter(function (user) {
              var containsSearchTerm = user.fullname.toLowerCase().indexOf(term.toLowerCase()) != -1;
              var isNotSelf = user.id != 1;
              return containsSearchTerm && isNotSelf;
            }));
          }, 500);
        },
        getComments: function (success, error) {
          // setTimeout(function() {
          // 	success(commentsArray);
          // }, 500);
          console.log("ahoieghaeioghaeg");
          $.ajax({
            type: 'get',
            url: '/getforumcomment?postid='+postid,
            data: {},
            success: function (comments) {
              for (var i = 0; i < comments.length; i++) {
                if (comments[i]['parent'].trim() == '') {
                  comments[i]['parent'] = null;
                }
                // comments[i]["created"] = "2015-01-01";
                // comments[i]["modified"] = "2015-01-01";
                comments[i]["attachments"] = [];
                console.log("comments");
                if (comments[i]["fullname"] == $("body").data("fullname")) {
                  comments[i]["created_by_current_user"] = true;
                }
                if (comments[i]["fullname"] == "Amitabh Verma") {
                  comments[i]["profile_picture_url"] = "https://media-exp1.licdn.com/dms/image/C5103AQGATiCoqSjZYg/profile-displayphoto-shrink_200_200/0?e=1605139200&v=beta&t=27sQMFdmiNj9DUs-9FgaIwibCCdNtDQwAJKTztpAXPI";
                }
                console.log(comments);
                var arr = comments[i]['upvoters'];
                    for (var j = 0; j < arr.length; j++) {
                        if (arr[j] == $('body').data('userid')) {
                            comments[i]['user_has_upvoted'] = true;
                        }
                    }
                // var arr = comments[i]['upvoters'];
                // for (var j = 0; j < arr.length; j++) {
                //     if (arr[j] == $('body').data('userid')) {
                //         comments[i]['user_has_upvoted'] = true;
                //     }
                // }
              }
              success(comments);
            }
          });
        },
        refresh: function(){
          $('li[data-sort-key="oldest"]').on("click", function(){
          })
          $('li[data-sort-key="newest"]').on("click", function(){
          })
          // $(".textarea, .upvote, .reply").on("click", function(){
          //   alert("aegag");
          // })
        },
        postComment: function (data, success, error) {
          var data2 = data;
          var attachmentsToBeCreated = data.attachments.filter(function(attachment){
            return !attachment.id
          });
          data.modulename = modulename;
          data.moduleid = moduleid;
          data.rootid = postid;
          console.log(data);
          if(attachmentsToBeCreated.length>0){
            data.file = attachmentsToBeCreated[0].file;
            data.type = attachmentsToBeCreated[0].mime_type;
            console.log("haeipgapieghaipegh")
            console.log(data.type);
            var file = data.file
            var bucket = new AWS.S3({params: {Bucket: 'ampdigital'}});
            var params = {Key: file.name, ContentType: data.type, Body: file};
            bucket.upload(params).on('httpUploadProgress', function(evt) {
              console.log("Uploading :: " + parseInt((evt.loaded * 100) / evt.total)+'% completed');
              // el.children('.progress').html("Uploading :: " + parseInt((evt.loaded * 100) / evt.total)+'% completed');
            }).send(function(err, data3) {
                // el.children('.progress').html("Processing... Please wait.");
                imageurl = data3.Location.toString();
                // data.fileurl = imageurl;
                // data.filetype = data.type
                console.log(imageurl);
                $.ajax({
                    type: "POST",
                    url: '/addnewcomment',
                    data: {
                      "id": data.id,
                      "rootid": data.rootid,
                      "parent": data.parent,
                      "fileurl": imageurl,
                      "filetype": data.type,
                      "created": data.created,
                      "modified": data.modified,
                      "content": data.content,
                      "fullname": data.fullname,
                      "profile_picture_url": data.profile_picture_url,
                      "created_by_current_user": data.created_by_current_user,
                      "upvote_count": data.upvote_count,
                      "user_has_upvoted": data.user_has_upvoted,
                      "modulename": modulename,
                      "moduleid": moduleid
                    },
                    success: function(result){
                      data.attachments = result;
                      data.attachment_url = imageurl
                      data.attachment_type = data.type;
                      data.attachment_id = result[0].id;
                      console.log("response");
                      console.log(data);
                      success(data);
                    }
                });
            });
          }
        
          else{
            $.ajax({
              type: 'post',
              url: '/addnewcomment',
              data: data,
              success: function (comment) {
                success(data);
                // success(data);
              }
            });
          }

        },
         putComment: function (data, success, error) {
          $.ajax({
            type: 'post',
            url: '/updatecomment',
            data: data,
            success: function (comment) {
              success(data);
              // success(data);
            }
          });
        },
        deleteComment: function (data, success, error) {
          $.ajax({
            type: 'post',
            url: '/deletecomment',
            data: data,
            success: function (comment) {
              success(data);
              // success(data);
            }
          });
        },
        upvoteComment: function (data, success, error) {
          $.ajax({
            type: 'post',
            url: '/upvotecomment',
            data: data,
            success: function (comment) {
              success(data);
              // success(data);
            }
          });
        },
        validateAttachments: function (attachments, callback) {
          setTimeout(function () {
            callback(attachments);
          }, 500);
        },
      });
    });
  </script>

</head>

<body style="background: #f5f7fb;font-family: Lato, Helvetica, Arial, sans-serif;
line-height: 20px;" data-userid="<%=userid%>" data-fullname="<%=fullname%>" data-name="<%=name%>""
 data-module_name="<%=module.module_name%>"
 data-post_id="<%=post.id%>"
  data-module_id="<%=module._id%>" data-module_url_id="<%=module.module_id%>">
  <div id="textModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
  
      <!-- Modal content-->
      <div class="modal-content">
  
        <!-- Modal Header -->
        <div class="modal-header" style="background: #6a4e77;">
          <h4 class="modal-title" style="color: white;">Post Question or Start Discussion</h4>
          <button type="button" class="close" data-dismiss="modal">×</button>
        </div>
  
        <!-- Modal body -->
        <div class="modal-body modal_body">
          <div class="commenting-field main">
            <div class="row align-items-center ml-0 round"><img style="width:3rem;"
                src="https://viima-app.s3.amazonaws.com/media/public/defaults/user-icon.png"></div>
                <form enctype="multipart/form-data" action="/addnewcomment3" method="POST">
                  <div class="form-group">
                    <label for="content">Your Question:</label>
                    <textarea class="form-control" rows="5" id="content" name="content"></textarea>
                  </div>
                  <input type="hidden" name="parent" value="<%=parent%>">
                  <input type="hidden" name="rootid" value="<%=post.id%>">
                  <input type="hidden" name="moduleid" value="<%=module._id%>">
                  <input type="hidden" name="modulename" value="<%=module.module_name%>">
                  <input type="hidden" name="url" value="<%=url%>">
                  <div class="form-group">
                    <label for="exampleFormControlFile1">(Optional) File</label>
                    <input type="file" name="avatar" class="form-control-file" id="exampleFormControlFile1">
                  </div>
                  <button type="submit" class="btn btn-default">Submit</button>
                </form>
          </div>
        </div>
      </div>
  
    </div>
  </div>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NTJGZ4L" height="0" width="0"
      style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
  <!-- header-->
  <%-include partials/header.ejs%>
  <%function getFileType( url ) {
    var url_extension = url.split(/[#?]/)[0].split('.').pop().trim().toLowerCase();
    if (/(jpg|gif|png|JPG|GIF|PNG|JPEG|jpeg)$/.test(url_extension)){
      return "image";
    }
    else if (/(ogg|mp3|mp?g|wav)$/.test(url_extension)){
      return "audio";
    }
    else if (/(ogg|mp4|mp?g|webm|3gp)$/.test(url_extension)){
      return "video";
    }
    else if (/(htm|html)$/.test(url_extension)){
      return "html";
    }
    else if (/(txt|md|csv|nfo|ini|json|php|js|css)$/.test(url_extension)){
      return "text";
    }
    else{
      return "other"
    }
  }%>
  <div class="container mt-5">
    <div class="row">
      <div class="col-md-8">
        <div class="row">
          <a href="/digital-marketing-community-forums/<%=module.module_id%>" class="btn btn-primary" type="button"> <i class="fa fa-arrow-left"></i> Back</a>

        </div>
        <div class="mt-1">
          <div class="media border p-3">
            <img src="https://ui-avatars.com/api/?name=<%=post.fullname%>&rounded=<%=post.fullname%>" alt="John Doe" class="mr-3 mt-3 rounded-circle" style="width:60px;">
            <div class="media-body">
              <h4> <%=post.fullname%> <small><i>Posted <%=moment(post.created).fromNow()%></i></small></h4>
              <p><%=post.content%></p>
              <%if(post.attachment_url && getFileType(post.attachment_url)=="image"){%>
                <div class="row">
                  <div class="file-preview-frame" id="preview-1606112811356-0" data-fileindex="0">
                    <img src="<%=post.attachment_url.split('?')[0]%>" class="file-preview-image" title="<%=post.attachment_url%>" alt="<%=post.attachment_url%>" style="width:auto;height:160px; margin-top:30px">
                    <div class="file-thumbnail-footer">
                     <div class="file-footer-caption" title="<%=post.attachment_url%>"><a href="<%=post.attachment_url.split('?')[0]%>">Download</a></div>
                   </div>
                 </div>
                </div>
              <%}else if(post.attachment_url){%>
                <div class="row">
                  <div class="file-preview-frame" id="preview-1606112811356-0" data-fileindex="0">
                    <div class="file-thumbnail-footer">
                     <div class="file-footer-caption" title="<%=post.attachment_url%>"><a href="<%=post.attachment_url.split('?')[0]%>">Attached File</a></div>
                   </div>
                 </div>
                </div>
                <%}%>
              <%let h = 0; for(let reply of replies){h++; let comment = reply;%>
              <div class="media p-3">
                <img src="https://ui-avatars.com/api/?name=<%=reply.fullname%>&rounded=<%=reply.fullname%>" alt="Jane Doe" class="mr-3 mt-3 rounded-circle" style="width:45px;">
                <div class="media-body">
                  <h4><%=reply.fullname%> <small><i>Posted <%=moment(comment.created).fromNow()%></i></small></h4>
                  <p><%=reply.content%></p>
                  <%if(comment.attachment_url && getFileType(comment.attachment_url)=="image"){%>
                    <div class="row">
                      <div class="file-preview-frame" id="preview-1606112811356-0" data-fileindex="0">
                        <img src="<%=comment.attachment_url.split('?')[0]%>" class="file-preview-image" title="<%=comment.attachment_url%>" alt="<%=comment.attachment_url%>" style="width:auto;height:160px; margin-top:30px">
                        <div class="file-thumbnail-footer">
                         <div class="file-footer-caption" title="<%=comment.attachment_url%>"><a href="<%=comment.attachment_url.split('?')[0]%>">Download</a></div>
                       </div>
                     </div>
                    </div>
                  <%}else if(comment.attachment_url){%>
                    <div class="row">
                      <div class="file-preview-frame" id="preview-1606112811356-0" data-fileindex="0">
                        <div class="file-thumbnail-footer">
                         <div class="file-footer-caption" title="<%=comment.attachment_url%>"><a href="<%=comment.attachment_url.split('?')[0]%>">Attached File</a></div>
                       </div>
                     </div>
                    </div>
                    <%}%>
                  <%if(replies.length==h){%>
                    <div class="row">
                      <div class="col"><a href="#" style="color: #6a4e77!important;" data-toggle="modal" data-target="#textModal">Reply</a></div>
                    </div><%}%>
                </div>
              </div> 
              <%}%>
              <%if(replies.length==0){%>
              <div class="row">
                <div class="col"><a href="#" style="color: #6a4e77!important;" data-toggle="modal" data-target="#textModal">Reply</a></div>
              </div><%}%>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <%-include partials/ebook.ejs%>

</body>

</html>